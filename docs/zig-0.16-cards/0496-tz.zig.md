# Migration Card: std/tz.zig

## 1) Concept

This file implements a parser for the Time Zone Information Format (TZif) as defined in RFC 8536. It handles time zone data files containing transitions between different time types (standard/daylight saving time), leap second information, and time zone designations. The key components include:

- `Transition` struct representing time transitions with timestamps and time types
- `Timetype` struct storing time zone offsets, flags, and names with methods for querying daylight saving status
- `Tz` struct as the main container for parsed time zone data with proper memory management
- `Leapsecond` struct for leap second correction records

## 2) The 0.11 vs 0.16 Diff

**Explicit Allocator Requirements:**
- `Tz.parse()` requires explicit allocator parameter: `parse(allocator: Allocator, reader: *Reader) !Tz`
- All internal allocations use the provided allocator with proper error defer cleanup
- `Tz` struct contains `allocator` field and requires manual cleanup via `deinit()` method

**I/O Interface Changes:**
- Uses dependency injection via `Reader` interface rather than concrete I/O types
- Reader methods follow new patterns: `takeStruct()`, `takeInt()`, `takeByte()`, `discardAll()`, `readSliceAll()`, `takeSentinel()`
- Endianness explicitly specified in all binary parsing operations

**Error Handling Changes:**
- Specific error types: `error.BadHeader`, `error.BadVersion`, `error.Malformed`, `error.OverlargeFooter`
- No generic error sets - each error case is explicitly handled
- RFC 8536 compliance checks with specific validation errors

**API Structure Changes:**
- Factory function pattern: `Tz.parse()` creates and returns initialized `Tz` instance
- Mandatory cleanup via `deinit()` method rather than automatic resource management
- Struct initialization with explicit allocator storage

## 3) The Golden Snippet

```zig
const std = @import("std");

pub fn main() !void {
    var arena = std.heap.ArenaAllocator.init(std.heap.page_allocator);
    defer arena.deinit();
    const allocator = arena.allocator();

    // Example with embedded timezone data
    const tz_data = @embedFile("path/to/timezone.tzif");
    var reader = std.io.fixedBufferStream(tz_data).reader();
    
    var tz = try std.tz.Tz.parse(allocator, &reader);
    defer tz.deinit();

    // Use the parsed timezone data
    for (tz.transitions) |transition| {
        std.debug.print("Transition at {} to {s}\n", .{
            transition.ts, 
            transition.timetype.name()
        });
    }
}
```

## 4) Dependencies

- `std.mem` (Allocator, slice operations, memory utilities)
- `std.io` (Reader interface for I/O operations)
- `std.math` (Integer bounds checking)
- Builtin types and operations (`@import("builtin")`)

This file contains public APIs for parsing timezone data files and is suitable for migration analysis.