# ASN.1 Codecs Migration Card

## 1) Concept

This file provides ASN.1 (Abstract Syntax Notation One) type definitions and codecs for public consumption in Zig's crypto library. It defines core ASN.1 constructs including tags, elements, bit strings, and opaque types that are fundamental to encoding/decoding cryptographic structures like certificates, keys, and other security-related data formats. The key components include:

- **Tag system**: Defines ASN.1 tag classes, numbers, and encoding/decoding logic
- **Element structure**: Represents decoded ASN.1 elements with position tracking
- **Type mappings**: Utilities for converting between Zig types and ASN.1 tags
- **BitString handling**: Specialized support for ASN.1 bit string types
- **DER integration**: Tight coupling with the DER encoder/decoder subsystem

## 2) The 0.11 vs 0.16 Diff

### I/O Interface Changes
The file shows significant migration from old `std.io` to new `std.Io` patterns:

- **Reader/Writers**: All I/O operations now use `std.Io.Reader` and `std.Io.Writer` instead of the old `std.io.Reader` interface
- **Method changes**: Uses `reader.takeByte()` instead of `reader.readByte()` and `writer.write()` instead of writer methods
- **Fixed readers**: Uses `std.Io.Reader.fixed()` for creating readers from buffers

### Error Handling Changes
- **Specific error sets**: Functions like `Element.decode()` return specific error sets (`DecodeError`) rather than generic errors
- **Error propagation**: Maintains explicit error handling with `try` and error sets

### API Structure Consistency
- **No allocator changes**: The public APIs in this file don't require allocators - they work directly with slices and fixed buffers
- **Static initialization**: Uses struct initializers (`Tag.init()`, `ExpectedTag.init()`) rather than factory functions
- **Type-safe encoding**: Maintains strong typing through enum parameters and compile-time type mapping

## 3) The Golden Snippet

```zig
const std = @import("std");
const asn1 = @import("std/crypto/codecs/asn1.zig");

// Decode an ASN.1 element from a buffer
pub fn example() !void {
    const der_data = [_]u8{ 0x30, 0x03, 0x02, 0x01, 0x09 }; // SEQUENCE containing INTEGER 9
    
    // Decode the element
    const element = try asn1.Element.decode(&der_data, 0);
    
    // Verify it's a constructed sequence
    try std.testing.expect(element.tag.class == .universal);
    try std.testing.expect(element.tag.number == .sequence);
    try std.testing.expect(element.tag.constructed == true);
    
    // Access the content slice
    const content = element.slice.view(&der_data);
    // content now contains [0x02, 0x01, 0x09]
}
```

## 4) Dependencies

- **std** - Core standard library
- **std.mem** - Memory operations (implicitly through std)
- **std.math** - Mathematical operations and bounds checking
- **std.Io** - New I/O interfaces for readers/writers
- **./asn1/der.zig** - DER encoding/decoding implementation
- **./asn1/Oid.zig** - Object identifier handling

The file maintains clean dependency boundaries with minimal external dependencies, focusing primarily on core std modules and related ASN.1 submodules.