# Argon2 Migration Card

## 1) Concept

This file implements the Argon2 password hashing algorithm, providing a secure key derivation function for password storage and verification. It supports three variants of Argon2: Argon2d (data-dependent, GPU-resistant), Argon2i (data-independent, side-channel resistant), and Argon2id (hybrid approach). The implementation includes both low-level KDF functions and higher-level password hashing interfaces with PHC format serialization.

Key components include:
- `Mode` enum for selecting Argon2 variants
- `Params` struct for configuring time/memory/parallelism parameters
- `kdf()` function for raw key derivation
- `strHash()` and `strVerify()` for password hashing workflows
- PHC format serialization/deserialization for storing hashes with parameters

## 2) The 0.11 vs 0.16 Diff

**Explicit Allocator Requirements:**
- `kdf()` now requires an explicit `mem.Allocator` as first parameter
- `strHash()` requires allocator via `HashOptions.allocator` field (optional but returns error if null)
- `strVerify()` requires allocator via `VerifyOptions.allocator` field (optional but returns error if null)

**API Structure Changes:**
- Factory pattern with explicit options structs instead of multiple parameters
- `HashOptions` struct consolidates allocator, parameters, mode, and encoding
- `VerifyOptions` struct specifically for allocator requirement
- Error handling uses specific error types (`KdfError`, `HasherError`) rather than generic errors

**Error Handling Changes:**
- Specific error types: `KdfError.WeakParameters`, `KdfError.OutputTooLong`
- `HasherError.PasswordVerificationFailed`, `HasherError.InvalidEncoding`
- `Error.AllocatorRequired` for missing allocator cases

## 3) The Golden Snippet

```zig
const std = @import("std");
const argon2 = std.crypto.argon2;

pub fn main() !void {
    var gpa = std.heap.GeneralPurposeAllocator(.{}){};
    const allocator = gpa.allocator();
    defer _ = gpa.deinit();

    const password = "my_secure_password";
    var hash_buf: [128]u8 = undefined;

    // Hash a password
    const hash_str = try argon2.strHash(
        password,
        .{
            .allocator = allocator,
            .params = .{ .t = 3, .m = 32, .p = 4 },
            .mode = .argon2id,
        },
        &hash_buf,
    );

    // Verify the password
    try argon2.strVerify(
        hash_str,
        password,
        .{ .allocator = allocator },
    );
}
```

## 4) Dependencies

- `std.mem` - Memory operations and allocator interfaces
- `std.crypto` - Cryptographic utilities and hash functions
- `std.crypto.pwhash` - Password hashing framework and PHC format
- `std.math` - Mathematical operations and bit manipulation
- `std.array_list` - Managed array list for block storage
- `std.Thread` - Multi-threading support for parallel processing
- `std.crypto.hash.blake2` - Blake2b hash function used internally