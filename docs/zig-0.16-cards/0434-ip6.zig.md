# Migration Card: std/os/uefi/protocol/ip6.zig

## 1) Concept

This file defines the Zig bindings for the UEFI IPv6 Protocol (EFI_IP6_PROTOCOL). It provides an interface for managing IPv6 network configurations, multicast groups, routing tables, neighbor cache entries, and packet transmission/reception in UEFI environments. The key components include:

- The main `Ip6` extern struct that wraps the UEFI protocol's function pointers
- Comprehensive error sets for each operation type (GetModeDataError, ConfigureError, etc.)
- Supporting types for IPv6 addresses, configuration data, routing tables, and neighbor cache entries
- Wrapper functions that convert UEFI status codes to Zig error unions with proper error handling

## 2) The 0.11 vs 0.16 Diff

**Explicit Allocator Requirements**: No allocator dependencies found. This is a direct UEFI protocol wrapper that operates on pre-allocated structures and completion tokens.

**I/O Interface Changes**: No traditional I/O streams. Uses UEFI's completion token pattern with asynchronous operations via `transmit`, `receive`, and `poll` functions.

**Error Handling Changes**: Uses comprehensive, function-specific error sets rather than generic error types:
- Each public function has its own error set (e.g., `GetModeDataError`, `ConfigureError`)
- Error sets combine UEFI-specific errors with `uefi.UnexpectedError`
- Pattern: `switch` statements on status codes with explicit error mapping

**API Structure Changes**: No init/factory patterns. The protocol is obtained through UEFI's protocol location services. Functions use consistent naming that matches UEFI specification:
- `getModeData()` - gets current operational state
- `configure()` / `disable()` - manages protocol configuration
- `groups()` / `leaveAllGroups()` - multicast group management
- `routes()` - routing table management
- `neighbors()` - neighbor cache management
- `transmit()` / `receive()` / `cancel()` - packet operations
- `poll()` - asynchronous operation polling

## 3) The Golden Snippet

```zig
const std = @import("std");
const uefi = std.os.uefi;

// Assuming we have obtained an Ip6 protocol instance
fn configureIp6Protocol(ip6: *uefi.protocol.Ip6) !void {
    var config = uefi.protocol.Ip6.Config{
        .default_protocol = 6, // TCP
        .accept_any_protocol = false,
        .accept_icmp_errors = true,
        .accept_promiscuous = false,
        .destination_address = [_]u8{0} ** 16,
        .station_address = [_]u8{0x20, 0x01, 0x0d, 0xb8} ++ [_]u8{0} ** 12, // Example IPv6
        .traffic_class = 0,
        .hop_limit = 64,
        .flow_label = 0,
        .receive_timeout = 0,
        .transmit_timeout = 0,
    };

    try ip6.configure(&config);
    
    // Join a multicast group
    const multicast_addr = [_]u8{0xFF, 0x02} ++ [_]u8{0} ** 14; // All nodes address
    try ip6.groups(.join, &multicast_addr);
}
```

## 4) Dependencies

- `std` - Root standard library import
- `std.os.uefi` - UEFI subsystem core types and utilities
- `std.os.uefi.Guid` - Protocol identification
- `std.os.uefi.Event` - Asynchronous event handling
- `std.os.uefi.Status` - UEFI status codes
- `std.os.uefi.MacAddress` - MAC address type
- `std.os.uefi.protocol.ManagedNetwork.Config` - Managed network configuration
- `std.os.uefi.protocol.SimpleNetwork` - Simple Network Protocol dependency