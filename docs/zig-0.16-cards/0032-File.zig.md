# Migration Card: std.Io.File

## 1) Concept

This file defines the `File` type and its associated operations for the new Zig 0.16 I/O system. It provides a cross-platform abstraction for file operations including reading, writing, seeking, and metadata operations. The key components include:

- Core `File` struct wrapping a file descriptor/handle
- Standard file handles (stdin, stdout, stderr)
- File metadata structures (`Stat`, `Kind`, `Mode`)
- Reader implementation with buffering and seek tracking
- File opening flags and error types for various operations

The design emphasizes dependency injection through the `Io` interface parameter, making file operations testable and allowing different I/O implementations.

## 2) The 0.11 vs 0.16 Diff

**Explicit I/O Interface Dependency Injection:**
- All file operations now require an `Io` parameter: `stat(file: File, io: Io)`, `close(file: File, io: Io)`, `openSelfExe(io: Io, flags: OpenFlags)`
- Reader initialization requires `Io`: `reader(file: File, io: Io, buffer: []u8)`

**New Reader Pattern:**
- Replaces direct file operations with buffered reader interface
- Reader tracks position, size, and mode (streaming vs positional)
- Supports both streaming and positional reading strategies

**Error Handling Changes:**
- Specific error types like `StatError`, `OpenError`, `SeekError`
- Error sets include `Io.Cancelable` and `Io.UnexpectedError`
- More granular error discrimination compared to generic error sets

**API Structure Changes:**
- `openAbsolute(io: Io, absolute_path: []const u8, flags: OpenFlags)` replaces direct path opening
- Reader construction requires explicit buffer allocation
- Separate functions for streaming vs positional reading strategies

## 3) The Golden Snippet

```zig
const std = @import("std");
const Io = std.Io;

// Open a file using the new I/O system
const io = std.io; // Get the I/O interface
const file = try Io.File.openAbsolute(io, "/path/to/file.txt", .{
    .mode = .read_only,
    .lock = .none,
    .follow_symlinks = true
});

// Create a buffered reader
var buffer: [4096]u8 = undefined;
var reader = Io.File.reader(file, io, &buffer);

// Read from the file using the reader interface
const bytes_read = try reader.interface.readVec(&reader.interface, &.{buffer});
```

## 4) Dependencies

- `std` (root import)
- `std.Io` (I/O interface system)
- `std.posix` (file descriptors and POSIX constants)
- `std.os.windows` (Windows-specific file operations)
- `std.fs` (file system operations and path utilities)
- `std.debug` (assertions)
- `std.mem` (implicitly through buffer operations)

This file represents a core part of Zig's new I/O system and has significant migration impact for file operations.