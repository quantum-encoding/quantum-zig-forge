# Migration Card: `std/crypto/codecs/asn1/der.zig`

## 1) Concept

This file provides Distinguished Encoding Rules (DER) encoding and decoding functionality for ASN.1 (Abstract Syntax Notation One), as defined in X.690 and X.691 standards. DER is a subset of Basic Encoding Rules (BER) that eliminates encoding flexibility to achieve deterministic encoding, commonly used in Public Key Infrastructure (PKI) applications.

The module provides two main components: a `Decoder` for parsing DER-encoded data into Zig types, and an `Encoder` for converting Zig values into DER-encoded bytes. The public API consists of convenience functions `decode()` and `encode()` that wrap the core decoder/encoder functionality for common use cases.

## 2) The 0.11 vs 0.16 Diff

**Explicit Allocator Requirements:**
- `encode()` function now requires an explicit `std.mem.Allocator` parameter
- Memory management follows Zig 0.16 patterns: caller owns returned memory and must free it

**API Structure Changes:**
- No factory functions - direct struct initialization for `Decoder`
- `Encoder` uses `init()` method pattern rather than direct struct initialization
- One-shot `encode()`/`decode()` functions maintain similar signatures but with allocator awareness

**Error Handling:**
- Functions use Zig's error union types (`!T`, `![]u8`)
- Error types remain generic rather than specific ASN.1 errors at this API level

## 3) The Golden Snippet

```zig
const std = @import("std");
const der = @import("std/crypto/codecs/asn1/der.zig");

pub fn main() !void {
    const allocator = std.heap.page_allocator;
    
    // Define a struct matching ASN.1 structure
    const CertificateInfo = struct {
        algorithm: der.asn1.Oid,
        value: i32,
    };
    
    // Encode a value to DER
    const cert_info = CertificateInfo{
        .algorithm = der.asn1.Oid.fromDotComptime("1.2.3.4"),
        .value = 42,
    };
    const encoded = try der.encode(allocator, cert_info);
    defer allocator.free(encoded);
    
    // Decode back from DER
    const decoded = try der.decode(CertificateInfo, encoded);
    
    std.debug.print("Original and decoded match: {}\n", .{
        std.meta.eql(cert_info, decoded)
    });
}
```

## 4) Dependencies

- `std.mem` - For allocator types and memory management
- `std.debug` - For runtime assertions and testing
- `std.crypto.codecs.asn1` - Core ASN.1 types and functionality
- `std.testing` - For test framework (test-only dependency)

**Primary Dependencies Graph:**
```
std.mem.Allocator → der.encode()
std.crypto.codecs.asn1 → der.asn1.Oid
std.debug → runtime validation
```