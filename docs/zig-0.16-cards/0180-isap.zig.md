# Migration Card: `std/crypto/isap.zig`

## 1) Concept
This file implements the ISAPv2 authenticated encryption system (specifically the IsapA128A variant), which is designed to be hardened against side-channel attacks and fault injection. It provides a cryptographic primitive suitable for environments where physical access to devices or hardware-level attacks are part of the threat model. The implementation offers encryption and decryption with authentication, using the Ascon permutation as its underlying cryptographic primitive.

Key components include:
- `encrypt()` function for authenticated encryption
- `decrypt()` function for authenticated decryption with tag verification
- Internal `mac()` function for message authentication code generation
- Internal `xor()` function for stream cipher operations
- Constants defining key sizes (16 bytes), nonce sizes (16 bytes), and tag sizes (16 bytes)

## 2) The 0.11 vs 0.16 Diff

**No significant API migration changes detected.** This crypto module maintains a consistent pattern:

- **No allocator requirements**: All operations work with pre-allocated buffers
- **Static functions only**: The API consists entirely of static functions on the `IsapA128A` struct
- **Direct buffer manipulation**: Both `encrypt` and `decrypt` operate directly on provided slices
- **Error handling unchanged**: Uses specific `AuthenticationError` (no generic error union changes)
- **No I/O interface changes**: Pure cryptographic operations without file/stream dependencies

The API follows a traditional cryptographic pattern where:
- Functions take input/output buffers as parameters
- No factory functions or instance management required
- All cryptographic state is internal and zeroed after use

## 3) The Golden Snippet

```zig
const std = @import("std");
const IsapA128A = std.crypto.isap.IsapA128A;

// Setup
const key = [_]u8{0x01} ** 16;
const nonce = [_]u8{0x02} ** 16;
const ad = "associated_data";
const message = "test";

// Encryption
var ciphertext: [message.len]u8 = undefined;
var tag: [16]u8 = undefined;
IsapA128A.encrypt(&ciphertext, &tag, message, ad, nonce, key);

// Decryption  
var decrypted: [message.len]u8 = undefined;
try IsapA128A.decrypt(&decrypted, &ciphertext, tag, ad, nonce, key);
```

## 4) Dependencies

The file imports these core modules:
- `std.mem` (for memory operations, byte reading, and equality testing)
- `std.crypto` (for core cryptographic primitives and error types)
- `std.debug` (for assertions)
- `std.math` (for bit manipulation)
- `std.testing` (for test infrastructure only)

**Primary crypto dependencies:**
- `std.crypto.core.Ascon` (underlying permutation)
- `std.crypto.errors.AuthenticationError`
- `std.crypto.timing_safe` (for constant-time comparisons)