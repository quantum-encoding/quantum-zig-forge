# Migration Card: `std/once.zig`

## 1) Concept

This file implements a thread-safe "once" initialization pattern in Zig's standard library. It provides a mechanism to ensure a function is executed exactly once, even when called concurrently from multiple threads. The key component is the `Once` type, which wraps a function and guarantees its single execution through atomic operations and mutex synchronization.

The implementation uses a combination of atomic boolean checks for the fast path (when initialization is already complete) and a mutex-protected slow path for the actual initialization. This provides both thread safety and performance optimization for the common case where initialization has already occurred.

## 2) The 0.11 vs 0.16 Diff

**No significant API changes detected** - this module maintains stable patterns:

- **No allocator requirements**: The API doesn't require memory allocators
- **No I/O interface changes**: Pure synchronization primitive without I/O dependencies  
- **No error handling changes**: The wrapped function must be `fn () void` (no errors)
- **Stable API structure**: Factory function `once()` returns `Once` instance, with `call()` method

The public API remains consistent with Zig 0.11 patterns:
- Factory function `once(comptime f: fn () void)` creates instances
- Method-based usage: `instance.call()`
- No breaking changes in function signatures or usage patterns

## 3) The Golden Snippet

```zig
const std = @import("std");

var counter: i32 = 0;
var my_once = std.once(incrementCounter);

fn incrementCounter() void {
    counter += 1;
}

pub fn main() void {
    // Safe to call multiple times - executes only once
    my_once.call();
    my_once.call();
    my_once.call();
    
    std.debug.print("Counter: {}\n", .{counter}); // Output: Counter: 1
}
```

## 4) Dependencies

- `std.zig` (root standard library import)
- `builtin` (for compile-time target information)
- `std.testing` (test utilities only)
- `std.Thread.Mutex` (thread synchronization primitive)

**Primary runtime dependency**: `std.Thread` for mutex implementation