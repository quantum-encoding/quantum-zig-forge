# Migration Card: `std/os/linux/bpf.zig`

## 1) Concept

This file provides a comprehensive Zig interface for Linux Berkeley Packet Filter (BPF), which is the underlying technology for eBPF programs. It contains low-level BPF instruction definitions, system call interfaces, and helper functions for working with BPF maps and programs.

Key components include:
- BPF instruction encoding with helper methods for creating ALU, jump, load/store, and other instruction types
- System call command definitions and attribute structures for BPF operations
- Map and program type definitions with their respective properties
- Wrapper functions for common BPF operations like map creation, element lookup/update, and program loading

## 2) The 0.11 vs 0.16 Diff

This file maintains a stable low-level system interface with minimal migration impact:

- **No explicit allocator requirements**: All functions operate on file descriptors and raw memory buffers without heap allocation
- **Direct system call interface**: Uses `linux.bpf()` syscall wrapper with attribute structures
- **Error handling consistency**: Uses standard POSIX error patterns with `std.posix.unexpectedErrno`
- **Stable API structure**: Function signatures remain consistent as they wrap direct kernel interfaces

The public API consists primarily of:
- BPF instruction construction methods (compile-time helpers)
- Syscall wrapper functions (`map_create`, `map_lookup_elem`, `prog_load`, etc.)
- Constant definitions for BPF operations and flags

## 3) The Golden Snippet

```zig
const std = @import("std");
const bpf = std.os.linux.bpf;

// Create a BPF hash map
const map_fd = try bpf.map_create(.hash, 4, 4, 32);
defer std.os.close(map_fd);

// Store and retrieve a value
const key = std.mem.zeroes([4]u8);
var value = std.mem.zeroes([4]u8);

try bpf.map_update_elem(map_fd, &key, &value, 0);
try bpf.map_lookup_elem(map_fd, &key, &value);
```

## 4) Dependencies

- `std.os.linux` (for system call definitions and error handling)
- `std.mem` (for zeroing structures)
- `std.testing` (for test utilities, not required for public API)

This file provides stable low-level BPF interfaces that haven't required significant migration changes between Zig versions, as they directly wrap kernel system calls with minimal abstraction.