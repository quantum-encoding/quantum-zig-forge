# Migration Card: std/crypto/Sha1.zig

## 1) Concept

This file implements the SHA-1 cryptographic hash function as a streaming hash API. It provides both one-shot hashing (`hash` function) and incremental hashing capabilities through an init/update/final pattern. The implementation includes the core SHA-1 algorithm with proper padding and length encoding, following the standard SHA-1 specification.

Key components include the `Sha1` struct that maintains internal state (hash values, buffer, and counters), public constants for block and digest lengths, and the main hashing functions that process data in 64-byte blocks through multiple rounds of bit operations.

## 2) The 0.11 vs 0.16 Diff

**No significant API signature changes detected.** The SHA-1 implementation follows consistent patterns:

- **No allocator requirements**: The API is entirely allocation-free, using stack-based structures
- **Consistent initialization**: `init()` returns a struct directly rather than requiring factory functions
- **Streaming interface unchanged**: `update()` and `final()` maintain the same pointer-based state modification pattern
- **Error handling**: No error returns - all operations are infallible
- **Options pattern**: Uses an empty `Options` struct for future extensibility, consistent with modern Zig patterns

The main changes are internal implementation details:
- Use of `@memcpy` and `@memset` instead of `std.mem.copy`/`std.mem.set`
- Explicit `@intCast` for type conversions
- Compile-time computed round parameters using `comptime` and inline loops

## 3) The Golden Snippet

```zig
const std = @import("std");
const Sha1 = std.crypto.Sha1;

// One-shot hashing
var output: [Sha1.digest_length]u8 = undefined;
Sha1.hash("hello world", &output, .{});

// Streaming hashing
var hasher = Sha1.init(.{});
hasher.update("hello");
hasher.update(" world");
hasher.final(&output);

// Peek at current hash without finalizing
var current_hash = hasher.peek();
```

## 4) Dependencies

- `std.mem` - For memory operations and endian-aware integer reading/writing
- `std.math` - For bit rotation operations (`rotl`)

The implementation is self-contained with minimal dependencies, focusing primarily on core memory and mathematical operations required for the hash algorithm.