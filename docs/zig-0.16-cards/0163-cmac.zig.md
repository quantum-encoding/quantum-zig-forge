# Migration Card: `std/crypto/cmac.zig`

## 1) Concept

This file implements CMAC (Cipher-based Message Authentication Code) functionality following NIST Special Publication 800-38B. It provides a generic CMAC implementation that can work with any block cipher, with a specific instantiation for AES-128 (CmacAes128) following RFC 4493.

The key components include:
- A generic `Cmac` type constructor that takes any block cipher type
- Stateful authentication context with `init`, `update`, and `final` methods
- One-shot `create` function for simple use cases
- Internal block cipher context management and subkey generation

## 2) The 0.11 vs 0.16 Diff

**No significant API changes detected from 0.11 patterns:**

- **No Allocator Requirements**: The API is allocator-free - all operations work with stack-allocated buffers and state
- **No I/O Interface Changes**: Pure cryptographic processing without file/stream I/O dependencies
- **No Error Handling Changes**: All functions are `void`-returning or return simple structs - no error unions
- **Consistent API Structure**: Maintains traditional `init/update/final` pattern plus one-shot `create`

**Key stability points:**
- Function signatures remain simple and allocation-free
- Block cipher dependency injected via comptime parameter
- Buffer management handled entirely by caller
- No breaking changes to public API structure

## 3) The Golden Snippet

```zig
const std = @import("std");
const CmacAes128 = std.crypto.cmac.CmacAes128;

pub fn main() void {
    const key = [_]u8{
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
    };
    const msg = [_]u8{
        0x6b, 0xc1, 0xbe, 0xe2, 0x2e, 0x40, 0x9f, 0x96, 
        0xe9, 0x3d, 0x7e, 0x11, 0x73, 0x93, 0x17, 0x2a,
    };
    
    var mac: [CmacAes128.mac_length]u8 = undefined;
    CmacAes128.create(&mac, &msg, &key);
    
    // mac now contains the computed authentication code
}
```

## 4) Dependencies

- `std.mem` - For memory operations and integer reading/writing
- `std.crypto` - For cryptographic primitives and block ciphers
- `std.crypto.core.aes` - Specifically for AES-128 implementation

**Note**: This is a stable cryptographic API with minimal dependencies, making it low-risk for migration.