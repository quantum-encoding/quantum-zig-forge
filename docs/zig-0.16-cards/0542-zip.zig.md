# Migration Card: std.zip

## 1) Concept

This file implements ZIP archive reading and extraction functionality for Zig's standard library. It provides low-level parsing of ZIP file structures including local file headers, central directory records, and end records, along with high-level extraction capabilities. The key components include struct definitions for ZIP format headers, an iterator for walking through archive entries, and decompression support for stored and deflated content.

The module handles both standard ZIP files and ZIP64 extensions for large files, with safety checks for path traversal prevention and comprehensive error handling for malformed archives. It supports streaming extraction without requiring the entire archive to be loaded into memory.

## 2) The 0.11 vs 0.16 Diff

**Explicit Allocator Requirements:**
- No explicit allocator parameters in public APIs - allocators are only used internally by the `Diagnostics` struct
- `Diagnostics` struct requires allocator at initialization and has explicit `deinit()` method

**I/O Interface Changes:**
- Uses new `std.Io` module with `Reader`/`Writer` interfaces instead of old stream APIs
- `Decompress` struct wraps different compression methods with a unified `Reader` interface
- File operations use dependency injection through `std.fs.Dir` parameters

**Error Handling Changes:**
- Specific error sets like `EndRecord.FindBufferError`, `EndRecord.FindFileError`
- Extensive use of custom error domains (`error.ZipNoEndRecord`, `error.ZipMultiDiskUnsupported`, etc.)
- Error propagation through the new `Io` interface error handling

**API Structure Changes:**
- Factory pattern for `Iterator.init()` returning initialized iterator
- `extract()` as main entry point taking options struct
- `Entry.extract()` method with explicit destination directory parameter

## 3) The Golden Snippet

```zig
const std = @import("std");

pub fn extractZip(allocator: std.mem.Allocator, zip_path: []const u8, dest_dir: std.fs.Dir) !void {
    const file = try std.fs.cwd().openFile(zip_path, .{});
    defer file.close();
    
    var reader = file.reader();
    var diagnostics: std.zip.Diagnostics = .{ .allocator = allocator };
    defer diagnostics.deinit();
    
    const options = std.zip.ExtractOptions{
        .diagnostics = &diagnostics,
        .verify_checksums = true,
    };
    
    try std.zip.extract(dest_dir, &reader, options);
    
    if (diagnostics.root_dir.len > 0) {
        std.debug.print("Extracted to common root: {s}\n", .{diagnostics.root_dir});
    }
}
```

## 4) Dependencies

- `std.mem` (byte swapping, memory operations, buffer manipulation)
- `std.fs` (file system operations, directory handling)
- `std.compress.flate` (deflate decompression implementation)
- `std.Io` (reader/writer interfaces for streaming)
- `std.math` (integer limits and mathematical operations)