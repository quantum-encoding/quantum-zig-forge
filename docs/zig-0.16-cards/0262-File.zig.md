# Migration Card: `std.fs.File`

## 1) Concept

This file provides the cross-platform `File` type for file I/O operations in Zig's standard library. It serves as the primary interface for file handling, wrapping OS-specific file descriptors/handles and providing unified APIs for reading, writing, seeking, locking, and metadata operations. Key components include:

- Core `File` struct with OS handle abstraction
- Standard stream accessors (`stdin`, `stdout`, `stderr`)
- Reader/Writer interfaces for buffered I/O
- File metadata and permission management
- Cross-platform file locking capabilities
- Integration with the new `std.Io` module for async I/O

## 2) The 0.11 vs 0.16 Diff

### Explicit Allocator Requirements
- **No explicit allocator changes** in this file's public API
- File operations remain allocator-free for basic I/O
- Reader/Writer interfaces manage their own buffering without external allocators

### I/O Interface Changes
- **New `std.Io` integration**: Many types now delegate to `Io.File` equivalents
- **Reader/Writer initialization**: Now requires explicit buffer allocation
  ```zig
  // 0.16 pattern
  var buffer: [4096]u8 = undefined;
  var reader = file.reader(io, &buffer);
  var writer = file.writer(&buffer);
  ```
- **Deprecated APIs**: Multiple types marked as deprecated in favor of `Io.File` equivalents:
  - `OpenError`, `OpenMode`, `Lock`, `OpenFlags`
  - `Reader` now delegates to `Io.File.Reader`
  - `preadAll`, `pwriteAll`, `copyRange` deprecated in favor of `Writer`

### Error Handling Changes
- **OS-specific error sets**: Uses `posix.*Error` and `windows.*Error` types
- **Granular error handling**: Separate error sets for different operations (`ReadError`, `WriteError`, `SeekError`, etc.)
- **Error propagation**: Writer struct tracks errors internally for later handling

### API Structure Changes
- **Reader/Writer construction**: Factory functions replace direct struct initialization
- **Positional vs Streaming modes**: Explicit mode selection for thread safety
- **New adapter functions**: `adaptToNewApi()` and `adaptFromNewApi()` for Io.File compatibility
- **Enhanced permissions**: Cross-platform `Permissions` struct with platform-specific inner types

## 3) The Golden Snippet

```zig
const std = @import("std");

pub fn main() !void {
    // Get standard output file
    const stdout_file = std.fs.File.stdout();
    
    // Create buffered writer
    var buffer: [4096]u8 = undefined;
    var writer = stdout_file.writer(&buffer);
    
    // Write data
    try writer.interface.writeAll("Hello, Zig 0.16!\n", .{});
    
    // Example with error handling
    const file = try std.fs.cwd().openFile("example.txt", .{});
    defer file.close();
    
    // Read using buffered reader
    var read_buffer: [1024]u8 = undefined;
    const io = std.io;
    var reader = file.reader(io, &read_buffer);
    
    const data = try reader.interface.readAllAlloc(std.heap.page_allocator, 1024);
    defer std.heap.page_allocator.free(data);
}
```

## 4) Dependencies

### Core Dependencies
- `std.posix` - POSIX system calls and constants
- `std.os.windows` - Windows-specific APIs
- `std.mem` - Memory operations and allocators
- `std.math` - Mathematical utilities and bounds checking
- `std.debug` - Assertion support

### I/O Subsystem
- `std.Io` - New I/O abstraction layer
- `std.io` - Legacy I/O utilities (transitional)

### Platform Detection
- `builtin` - Compiler intrinsics and target information
- `std.builtin.Os` - OS tag definitions

### Time Utilities
- `std.time` - Time constants and conversions

This file represents a transitional API that bridges legacy file operations with the new `std.Io` system while maintaining backward compatibility for common file I/O patterns.