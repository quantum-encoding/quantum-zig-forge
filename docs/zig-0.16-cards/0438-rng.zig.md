# Migration Card: Zig 0.16 UEFI RNG Protocol

## 1) Concept

This file implements the UEFI (Unified Extensible Firmware Interface) Random Number Generator (RNG) protocol for Zig. It provides a wrapper around the UEFI RNG service that allows generating cryptographically secure random numbers in UEFI environments. The main component is the `Rng` extern struct that contains function pointers to the underlying UEFI protocol methods and provides Zig-friendly wrapper functions.

Key components include:
- The `Rng` protocol struct with `getInfo` and `getRNG` methods
- Error type definitions for each operation
- Standard algorithm GUIDs for different RNG implementations (SP800-90 variants, X9.31, and raw)
- Protocol and algorithm GUID definitions for UEFI service discovery

## 2) The 0.11 vs 0.16 Diff

**Error Handling Changes:**
- Uses union error sets (`GetInfoError` and `GetRNGError`) that combine `uefi.UnexpectedError` with specific error enums
- Error handling follows the pattern of switching on status codes and returning Zig error types
- No generic error types - each function has precisely defined error sets

**API Structure:**
- Pure extern struct with no allocator dependencies
- Direct method calls on protocol instances obtained from UEFI services
- Buffer management is caller-allocated (no implicit allocations)
- Alignment requirements explicitly specified in function signatures

**Function Signature Patterns:**
- `getInfo` returns a slice of the input buffer populated with supported algorithms
- `getRNG` writes directly into caller-provided buffer with optional algorithm specification
- Both methods use `*const Rng` receiver pattern consistent with UEFI protocol conventions

## 3) The Golden Snippet

```zig
const std = @import("std");
const uefi = std.os.uefi;

// Assume rng_protocol is obtained via UEFI LocateProtocol
fn generateRandomBytes(rng_protocol: *const uefi.protocol.Rng) void {
    var random_data: [32]u8 = undefined;
    
    // Generate 32 random bytes using default algorithm
    rng_protocol.getRNG(null, random_data[0..]) catch |err| {
        // Handle RNG failure
        return;
    };
    
    // Use random_data...
}
```

## 4) Dependencies

- `std.os.uefi` - Core UEFI infrastructure
- `std.os.uefi.Guid` - GUID handling for protocol and algorithm identification  
- `std.os.uefi.Status` - UEFI status code definitions and error handling
- `std.os.uefi.cc` - UEFI calling convention specifications

**Note:** This is a UEFI-specific protocol implementation that depends entirely on the UEFI subsystem. No standard allocators or I/O interfaces are used.