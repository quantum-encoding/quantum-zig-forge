# Migration Card: `std.debug.Pdb`

## 1) Concept

This file implements a parser for Microsoft Program Database (PDB) debug information files. It provides functionality to read and parse PDB file structures, extract debug symbols, line number information, and module metadata from Windows debug files. The key components include:

- The main `Pdb` struct that manages the PDB file state, including MSF (Multi-Stream File) structure, modules, and string tables
- `Module` struct representing individual compilation modules with their symbols and debug information
- `MsfStream` for handling the MSF file format's stream-based storage system
- Parsing functions for DBI (Debug Information) and PDB Info streams

## 2) The 0.11 vs 0.16 Diff

**Explicit Allocator Requirements:**
- `init()` function requires explicit allocator parameter: `pub fn init(gpa: Allocator, file_reader: *File.Reader) !Pdb`
- All memory management operations use the stored allocator instance
- `Module.deinit()` takes explicit allocator parameter

**I/O Interface Changes:**
- Uses `std.Io.Reader` interface throughout for stream reading operations
- `File.Reader` is injected via constructor and used for all file operations
- Stream operations use new I/O patterns like `streamDelimiterLimit()` and buffered reading

**Error Handling Changes:**
- Specific error types like `error.InvalidDebugInfo`, `error.MissingDebugInfo`, `error.UnknownPDBVersion`
- No generic error sets - uses explicit error returns for different failure conditions

**API Structure Changes:**
- Factory pattern with `init()` constructor rather than open/close methods
- Explicit `deinit()` for resource cleanup
- Stateful parsing with `parseDbiStream()` and `parseInfoStream()` methods

## 3) The Golden Snippet

```zig
const std = @import("std");
const Pdb = std.debug.Pdb;

// Open PDB file and initialize parser
var file = try std.fs.cwd().openFile("debug.pdb", .{});
defer file.close();

var file_reader = file.reader();
var gpa = std.heap.GeneralPurposeAllocator(.{}){};

var pdb = try Pdb.init(gpa.allocator(), &file_reader);
defer pdb.deinit();

// Parse PDB streams
try pdb.parseInfoStream();
try pdb.parseDbiStream();

// Access module information
if (try pdb.getModule(0)) |module| {
    const symbol_name = pdb.getSymbolName(module, 0x4000);
    // Use symbol information...
}
```

## 4) Dependencies

- `std.mem` (as `Allocator`) - Heavy usage for memory management
- `std.fs.File` - File I/O operations
- `std.pdb` - PDB-specific data structures and constants  
- `std.debug` - Assertions and source location types
- `std.io` - Reader/Writer interfaces and streaming operations
- `std.array_list` - Dynamic array management
- `std.heap` (indirectly through allocator usage)