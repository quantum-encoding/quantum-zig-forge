# Migration Card: P256 Elliptic Curve Implementation

## 1) Concept

This file implements group operations for the P256 elliptic curve (also known as secp256r1 or prime256v1). It provides a complete implementation of elliptic curve cryptography operations including point addition, doubling, scalar multiplication, and serialization in SEC-1 formats. The core `P256` struct represents points in projective coordinates for efficiency, with methods for converting to/from affine coordinates and handling the curve's neutral element.

Key components include:
- The `P256` struct with projective coordinates (x, y, z)
- Affine coordinate representation via `AffineCoordinates` struct
- SEC-1 format serialization/deserialization (compressed and uncompressed)
- Constant-time and variable-time scalar multiplication algorithms
- Point validation and identity element handling

## 2) The 0.11 vs 0.16 Diff

### Explicit Allocator Requirements
**No changes detected**: This is a pure mathematical implementation that operates on fixed-size arrays and field elements. No dynamic memory allocation is required, so no allocator parameters are present in the public API.

### I/O Interface Changes
**No changes detected**: The file uses mathematical operations on field elements rather than I/O streams. Serialization methods work directly with byte arrays.

### Error Handling Changes
**Consistent error types**: The API uses specific error sets imported from `crypto.errors`:
- `EncodingError` for invalid point encodings
- `IdentityElementError` for neutral element rejection
- `NonCanonicalError` for non-canonical field element representations
- `NotSquareError` for square root operations on non-quadratic residues

### API Structure Changes
**Endianness parameter standardization**: Several methods now explicitly require endianness specification:

```zig
// 0.16 pattern - explicit endian parameter
pub fn fromSerializedAffineCoordinates(xs: [32]u8, ys: [32]u8, endian: std.builtin.Endian) (NonCanonicalError || EncodingError)!P256
pub fn mul(p: P256, s_: [32]u8, endian: std.builtin.Endian) IdentityElementError!P256
pub fn mulPublic(p: P256, s_: [32]u8, endian: std.builtin.Endian) IdentityElementError!P256
```

**Factory functions with error returns**: Creation methods return error unions rather than using `catch unreachable` in public APIs.

## 3) The Golden Snippet

```zig
const std = @import("std");
const crypto = std.crypto;

// Generate a random point on P256 curve
const random_point = crypto.pcurves.P256.random();

// Convert to compressed SEC-1 format
const compressed = random_point.toCompressedSec1();

// Convert back from SEC-1 format
const recovered_point = try crypto.pcurves.P256.fromSec1(&compressed);

// Verify the points are equivalent
const is_same = random_point.equivalent(recovered_point);
```

## 4) Dependencies

- `std` - Core standard library
- `std.crypto` - Cryptographic primitives and error definitions
- `std.mem` - Memory operations (used internally)
- `std.meta` - Type metadata operations
- Internal modules:
  - `p256/field.zig` - Prime field arithmetic
  - `p256/scalar.zig` - Scalar arithmetic modulo curve order

**Note**: The implementation is self-contained within the crypto module and doesn't depend on external I/O or memory allocation subsystems.