# Migration Card: UEFI UDP6 Protocol

## 1) Concept

This file implements the UEFI UDP6 protocol interface for Zig, providing UDP over IPv6 networking capabilities in UEFI firmware environments. It defines the main `Udp6` protocol structure that contains function pointers for core UDP operations like configuration, transmission, reception, and multicast group management. The protocol follows the standard UEFI pattern of using completion tokens for asynchronous I/O operations.

Key components include:
- The `Udp6` extern struct with function pointers for protocol methods
- Error sets for each operation that map UEFI status codes to Zig errors
- Configuration structures for UDP session parameters
- Data structures for transmit/receive operations with fragment support
- Helper methods for accessing packet fragments

## 2) The 0.11 vs 0.16 Diff

This UEFI protocol implementation shows several Zig 0.16 patterns:

**Error Handling Changes:**
- Uses specific error sets for each operation (e.g., `GetModeDataError`, `TransmitError`) rather than generic error types
- Error sets combine `uefi.UnexpectedError` with operation-specific errors
- Status codes are explicitly mapped to Zig errors using switch statements

**API Structure Patterns:**
- No explicit allocator requirements - UEFI protocols manage their own memory
- All operations are methods on the `Udp6` protocol instance
- Completion-based asynchronous I/O model using tokens
- Strong typing for configuration parameters and data structures

**Function Signature Changes:**
- All protocol methods use `callconv(cc)` for UEFI calling convention
- Pointer parameters are explicitly typed with nullability annotations (`?*`)
- Self parameters are properly const-qualified where appropriate

## 3) The Golden Snippet

```zig
const std = @import("std");
const uefi = std.os.uefi;

// Assuming udp6_protocol is obtained from UEFI system table
var udp6: *uefi.protocol.Udp6 = ...;

// Configure UDP6 protocol
var config = uefi.protocol.Udp6.Config{
    .accept_promiscuous = false,
    .accept_any_port = true,
    .allow_duplicate_port = false,
    .traffic_class = 0,
    .hop_limit = 64,
    .receive_timeout = 0,
    .transmit_timeout = 0,
    .station_address = Ip6.Address{ ... },
    .station_port = 8080,
    .remote_address = Ip6.Address{ ... },
    .remote_port = 8080,
};

try udp6.configure(&config);

// Get current mode data
const mode_data = try udp6.getModeData();

// Join multicast group  
try udp6.groups(.join, &multicast_addr);
```

## 4) Dependencies

Heavily imported modules:
- `std.os.uefi` - Core UEFI types and constants
- `std.os.uefi.protocol.Ip6` - IPv6 protocol dependencies
- `std.os.uefi.protocol.ManagedNetwork` - Network configuration data
- `std.os.uefi.protocol.SimpleNetwork` - Basic network interface

The dependency graph shows this is part of the UEFI networking subsystem, building on lower-level network protocols while providing UDP-specific functionality.