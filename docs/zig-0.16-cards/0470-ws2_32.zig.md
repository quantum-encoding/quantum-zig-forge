# Migration Card: Windows Sockets 2 (ws2_32) Bindings

## 1) Concept

This file contains Zig bindings for the Windows Sockets 2 API (ws2_32.dll and mswsock.dll). It provides low-level Windows socket programming interfaces including:
- Socket creation and management (`socket`, `bind`, `connect`, `accept`)
- I/O operations (`send`, `recv`, `WSASend`, `WSARecv`)
- Address resolution (`getaddrinfo`, `getnameinfo`)
- Socket options and configuration
- Overlapped I/O operations for asynchronous networking
- Protocol-specific constants and structures for TCP, UDP, IP, IPv6

The file defines Windows-specific socket types, constants, and function signatures that mirror the native Windows Sockets API, making it suitable for direct system-level socket programming on Windows platforms.

## 2) The 0.11 vs 0.16 Diff

This is a low-level Windows API binding file with minimal Zig-specific migration changes:

**No Major API Changes Identified:**
- Functions maintain traditional C-style signatures with explicit parameter types
- No allocator parameter requirements (uses Windows system allocation)
- I/O interfaces remain callback-based with `OVERLAPPED` structures
- Error handling uses Windows error codes via `WSAGetLastError()` 
- All functions use `callconv(.winapi)` calling convention

**Windows-Specific Patterns:**
- Socket handles use opaque pointer type: `SOCKET = *opaque {}`
- Extensive use of Windows-specific types (`DWORD`, `HANDLE`, `GUID`, etc.)
- Overlapped I/O pattern with completion routines
- Extension functions via `WSAIoctl` with GUIDs

## 3) The Golden Snippet

```zig
const ws2_32 = @import("std").os.windows.ws2_32;

pub fn main() !void {
    var wsa_data: ws2_32.WSADATA = undefined;
    
    // Initialize Winsock
    const startup_result = ws2_32.WSAStartup(0x202, &wsa_data);
    if (startup_result != 0) {
        const err = ws2_32.WSAGetLastError();
        return error.WinsockInitFailed;
    }
    defer _ = ws2_32.WSACleanup();

    // Create TCP socket
    const sock = ws2_32.socket(ws2_32.AF.INET, ws2_32.SOCK.STREAM, ws2_32.IPPROTO.TCP);
    if (sock == ws2_32.INVALID_SOCKET) {
        const err = ws2_32.WSAGetLastError();
        return error.SocketCreationFailed;
    }
    defer _ = ws2_32.closesocket(sock);

    // Set socket option
    const enable = @as(u32, 1);
    const opt_result = ws2_32.setsockopt(
        sock,
        ws2_32.SOL.SOCKET,
        ws2_32.SO.REUSEADDR,
        @ptrCast(&enable),
        @sizeOf(@TypeOf(enable))
    );
    
    if (opt_result == ws2_32.SOCKET_ERROR) {
        const err = ws2_32.WSAGetLastError();
        return error.SetSockOptFailed;
    }
}
```

## 4) Dependencies

**Primary Imports:**
- `std.os.windows` (for Windows base types and constants)
- Windows system libraries: `ws2_32.dll`, `mswsock.dll`

**Key Type Dependencies:**
- Windows handle types (`HANDLE`, `OVERLAPPED`)
- Network types (`sockaddr`, `WSABUF`, `ADDRINFOEXW`)
- Protocol constants (`AF_INET`, `SOCK_STREAM`, `IPPROTO_TCP`)

**No Standard Library Allocators Used** - This is a direct system API binding layer.