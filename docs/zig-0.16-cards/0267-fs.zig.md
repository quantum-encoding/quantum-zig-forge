# Migration Card: `std.fs`

## 1) Concept

This file is the main entry point for Zig's cross-platform file system operations in the standard library. It provides abstractions for common file system tasks like creating directories, copying files, reading symbolic links, and obtaining the current executable's path. The module handles platform-specific differences (Windows, POSIX, WASI) and exposes both absolute and relative path operations through a unified interface.

Key components include:
- Constants for system path limits (`max_path_bytes`, `max_name_bytes`)
- Base64 encoding/decoding utilities for file system-safe strings
- Absolute path variants of common operations (e.g., `openDirAbsolute`, `createFileAbsolute`)
- Functions for working with the current executable (`selfExePath`, `openSelfExe`)
- Re-exports of submodules (`Dir`, `File`, `AtomicFile`, `path`)

## 2) The 0.11 vs 0.16 Diff

### Explicit Allocator Requirements
- **Memory-returning functions now require explicit allocators**: `selfExePathAlloc`, `selfExeDirPathAlloc`, and `realpathAlloc` all take an `Allocator` parameter, replacing previous patterns that might have used global allocators.

### I/O Interface Changes
- **Deprecated functions with new alternatives**: `cwd()` and `openSelfExe()` are marked as deprecated in favor of `Io.Dir.cwd` and `Io.File.openSelfExe`
- **New I/O module integration**: The `openSelfExe` function now uses the new `Io` module internally on Linux and Windows

### Error Handling Changes
- **More specific error types**: `SelfExePathError` is a comprehensive union of POSIX, Windows, and system-specific errors
- **Platform-specific error mapping**: Functions handle different error sets based on target OS

### API Structure Changes
- **Absolute path assertion**: Functions like `openDirAbsolute`, `createFileAbsolute` explicitly require absolute paths and delegate to `Dir` methods
- **Consistent naming**: Null-terminated variants use `Z` suffix (e.g., `makeDirAbsoluteZ`, `renameAbsoluteZ`)
- **Windows-specific APIs**: `symLinkAbsoluteW` provides Windows-native WTF16 interface

## 3) The Golden Snippet

```zig
const std = @import("std");
const fs = std.fs;

pub fn main() !void {
    const allocator = std.heap.page_allocator;
    
    // Get current executable path using 0.16 pattern
    const self_exe_path = try fs.selfExePathAlloc(allocator);
    defer allocator.free(self_exe_path);
    
    // Create a directory using absolute path
    try fs.makeDirAbsolute("/tmp/example_dir");
    
    // Create and write to a file
    const file = try fs.createFileAbsolute("/tmp/example_dir/test.txt", .{});
    defer file.close();
    try file.writeAll("Hello, Zig 0.16!");
    
    std.debug.print("Self exe path: {s}\n", .{self_exe_path});
}
```

## 4) Dependencies

- **`std.mem`** - Memory operations and buffer manipulation
- **`std.posix`** - POSIX system calls and constants
- **`std.os.windows`** - Windows-specific system APIs
- **`std.base64`** - Encoding/decoding utilities
- **`std.Io`** - New I/O abstraction layer
- **`std.crypto`** - Cryptographic utilities (for base64)
- **`std.heap`** - (Indirect) For allocator-dependent functions

This module serves as a bridge between high-level file system operations and platform-specific implementations, with clear migration paths from 0.11 patterns to the more explicit and allocator-aware 0.16 approach.