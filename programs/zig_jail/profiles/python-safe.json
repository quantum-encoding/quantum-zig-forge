{
  "profile_name": "python-safe",
  "description": "Secure Python execution - read-only system, write to sandbox only, no network, no subprocess",
  "version": "1.0.0",
  "author": "Zig Guardian Forge",
  "threat_model": "Untrusted Python scripts (e.g., AI-generated code, third-party libraries)",

  "syscalls": {
    "default_action": "kill",
    "comment": "Default to SECCOMP_RET_KILL - any unlisted syscall terminates process",

    "allowed": [
      "read",
      "write",
      "open",
      "openat",
      "close",
      "stat",
      "fstat",
      "lstat",
      "newfstatat",
      "statx",
      "access",
      "faccessat",
      "faccessat2",
      "readlink",
      "readlinkat",
      "getcwd",
      "chdir",
      "fchdir",
      "getdents",
      "getdents64",
      "lseek",
      "dup",
      "dup2",
      "dup3",
      "pipe",
      "pipe2",
      "ioctl",
      "fcntl",
      "flock",
      "fsync",
      "fdatasync",
      "truncate",
      "ftruncate",
      "getrlimit",
      "setrlimit",
      "prlimit64",
      "getrusage",
      "umask",
      "gettimeofday",
      "clock_gettime",
      "clock_getres",
      "clock_nanosleep",
      "nanosleep",
      "time",
      "times",
      "getpid",
      "gettid",
      "getppid",
      "getuid",
      "geteuid",
      "getgid",
      "getegid",
      "getgroups",
      "setuid",
      "setgid",
      "setgroups",
      "getresuid",
      "getresgid",
      "setresuid",
      "setresgid",
      "getpgid",
      "setpgid",
      "getpgrp",
      "setsid",
      "getsid",
      "capget",
      "capset",
      "prctl",
      "arch_prctl",
      "mmap",
      "munmap",
      "mremap",
      "mprotect",
      "madvise",
      "brk",
      "mlock",
      "munlock",
      "mlockall",
      "munlockall",
      "mincore",
      "msync",
      "remap_file_pages",
      "rt_sigaction",
      "rt_sigprocmask",
      "rt_sigreturn",
      "rt_sigpending",
      "rt_sigtimedwait",
      "rt_sigsuspend",
      "sigaltstack",
      "uname",
      "getrandom",
      "sysinfo",
      "futex",
      "set_tid_address",
      "set_robust_list",
      "get_robust_list",
      "exit",
      "exit_group",
      "wait4",
      "waitid",
      "poll",
      "ppoll",
      "select",
      "pselect6",
      "epoll_create",
      "epoll_create1",
      "epoll_ctl",
      "epoll_wait",
      "epoll_pwait",
      "eventfd",
      "eventfd2",
      "signalfd",
      "signalfd4",
      "timerfd_create",
      "timerfd_settime",
      "timerfd_gettime",
      "clone",
      "fork",
      "vfork",
      "sched_yield",
      "sched_getaffinity",
      "sched_setaffinity",
      "sched_getparam",
      "sched_setparam",
      "sched_getscheduler",
      "sched_setscheduler",
      "sched_get_priority_max",
      "sched_get_priority_min",
      "sched_rr_get_interval",
      "restart_syscall",
      "pread64",
      "pwrite64",
      "readv",
      "writev",
      "preadv",
      "pwritev",
      "preadv2",
      "pwritev2",
      "sendfile",
      "copy_file_range",
      "rseq",
      "execve",
      "io_uring_setup",
      "io_uring_enter",
      "clone3",
      "chmod",
      "fchmod",
      "fchmodat",
      "kill",
      "tgkill",
      "mkdir",
      "mkdirat",
      "rename",
      "renameat",
      "renameat2",
      "memfd_create",
      "execveat",
      "socketpair",
      "pidfd_open",
      "pidfd_send_signal",
      "recvfrom"
    ],

    "blocked": [
      "unlink",
      "unlinkat",
      "rmdir",
      "link",
      "linkat",
      "symlink",
      "symlinkat",
      "mknod",
      "mknodat",
      "chown",
      "fchown",
      "lchown",
      "fchownat",
      "mount",
      "umount",
      "umount2",
      "pivot_root",
      "chroot",
      "acct",
      "swapon",
      "swapoff",
      "reboot",
      "kexec_load",
      "kexec_file_load",
      "init_module",
      "finit_module",
      "delete_module",
      "iopl",
      "ioperm",
      "create_module",
      "query_module",
      "quotactl",
      "nfsservctl",
      "getpmsg",
      "putpmsg",
      "afs_syscall",
      "tuxcall",
      "security",
      "vserver",
      "bpf",
      "userfaultfd",
      "membarrier",
      "perf_event_open",
      "ptrace",
      "process_vm_readv",
      "process_vm_writev",
      "kcmp",
      "personality",
      "socket",
      "socketpair",
      "bind",
      "listen",
      "accept",
      "accept4",
      "connect",
      "getsockname",
      "getpeername",
      "sendto",
      "recvfrom",
      "sendmsg",
      "recvmsg",
      "sendmmsg",
      "recvmmsg",
      "shutdown",
      "setsockopt",
      "getsockopt",
      "execveat"
    ],

    "conditional": [
      {
        "comment": "Block write operations on protected system paths",
        "syscall": "open",
        "rules": [
          {
            "description": "Block O_WRONLY|O_RDWR|O_CREAT|O_TRUNC on /etc/",
            "arg": 1,
            "op": "masked_eq",
            "mask": "O_WRONLY|O_RDWR|O_CREAT|O_TRUNC",
            "action_if_match": "check_path",
            "paths_blocked": ["/etc/", "/boot/", "/sys/", "/proc/sys/", "/usr/lib/", "/usr/bin/", "/lib/", "/lib64/", "/bin/", "/sbin/"]
          }
        ]
      },
      {
        "comment": "Block write operations on protected system paths (openat variant)",
        "syscall": "openat",
        "rules": [
          {
            "description": "Block O_WRONLY|O_RDWR|O_CREAT|O_TRUNC on /etc/",
            "arg": 2,
            "op": "masked_eq",
            "mask": "O_WRONLY|O_RDWR|O_CREAT|O_TRUNC",
            "action_if_match": "check_path",
            "paths_blocked": ["/etc/", "/boot/", "/sys/", "/proc/sys/", "/usr/lib/", "/usr/bin/", "/lib/", "/lib64/", "/bin/", "/sbin/"]
          }
        ]
      }
    ]
  },

  "capabilities": {
    "comment": "Drop all Linux capabilities - process runs as unprivileged user",
    "drop_all": true,
    "keep": []
  },

  "namespaces": {
    "comment": "Isolate process in separate namespaces (future enhancement)",
    "enabled": [],
    "network": "none"
  },

  "filesystem": {
    "comment": "Path-based access control (enforced via conditional syscall rules above)",
    "protected_paths": [
      "/etc/",
      "/boot/",
      "/sys/",
      "/proc/sys/",
      "/usr/lib/",
      "/usr/bin/",
      "/lib/",
      "/lib64/",
      "/bin/",
      "/sbin/"
    ],
    "writable_sandbox": [
      "/tmp/",
      "/home/founder/sandbox/",
      "/home/founder/tmp/",
      "/var/tmp/"
    ]
  },

  "limits": {
    "comment": "Resource limits (future enhancement)",
    "max_open_files": 1024,
    "max_memory_mb": 4096,
    "max_cpu_time_sec": 300,
    "max_processes": 128
  },

  "audit": {
    "comment": "Logging and audit configuration",
    "log_violations": true,
    "log_allowed": false,
    "log_target": "stderr",
    "auditd_integration": true,
    "auditd_key": "zig_jail_python_safe"
  },

  "metadata": {
    "created": "2025-10-06",
    "tested_with": ["Python 3.11", "Python 3.12"],
    "use_cases": [
      "Running untrusted Python scripts from AI code generation",
      "Executing third-party Python libraries with unknown security posture",
      "Data processing scripts that should not modify system state"
    ],
    "known_limitations": [
      "Subprocess creation IS allowed (fork/execve) but child processes inherit the seccomp filter",
      "Cannot create network sockets - all socket syscalls blocked",
      "Cannot delete or rename files anywhere on filesystem (unlink/rmdir blocked)",
      "Cannot write to system directories (conditional rules - future enhancement)"
    ]
  }
}
