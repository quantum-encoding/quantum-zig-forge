From: Community Contributor
Subject: [PATCH] Add SocketNotListening to AcceptError set

The posix.accept() function can return error.SocketNotListening when
EINVAL is received (socket is not listening for connections). However,
this error was not included in the AcceptError error set, causing a
compile-time error when the error is returned.

This patch adds SocketNotListening to the Server.AcceptError error set
in lib/std/Io/net.zig.

Applies to: Zig 0.16.0-dev.1484+d0ba6642b
---
 lib/std/Io/net.zig | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/lib/std/Io/net.zig b/lib/std/Io/net.zig
index 1234567..abcdefg 100644
--- a/lib/std/Io/net.zig
+++ b/lib/std/Io/net.zig
@@ -1328,6 +1328,8 @@ pub const Server = struct {
     pub const AcceptError = error{
         /// The per-process limit on the number of open file descriptors has been reached.
         ProcessFdQuotaExceeded,
         /// The system-wide limit on the total number of open files has been reached.
         SystemFdQuotaExceeded,
         /// Not enough free memory. This often means that the memory allocation is limited
         /// by the socket buffer limits, not by the system memory.
         SystemResources,
         /// The network subsystem has failed.
         NetworkDown,
         /// No connection is already queued and ready to be accepted, and
         /// the socket is configured as non-blocking.
         WouldBlock,
         /// An incoming connection was indicated, but was subsequently terminated by the
         /// remote peer prior to accepting the call.
         ConnectionAborted,
         /// Firewall rules forbid connection.
         BlockedByFirewall,
         ProtocolFailure,
+        /// The socket is not listening for connections (EINVAL on accept).
+        SocketNotListening,
     } || Io.UnexpectedError || Io.Cancelable;
--
2.43.0
